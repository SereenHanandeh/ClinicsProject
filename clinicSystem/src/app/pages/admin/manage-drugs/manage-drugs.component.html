<h1>Drug Management</h1>

<form [formGroup]="drugForm"
      (ngSubmit)="onSubmit()"
      class="d-flex justify-content-center align-items-end mb-4 flex-wrap"
      style="gap: 10px;">

  <!-- حقل البحث -->
  <input type="text"
         [(ngModel)]="searchTerm"
         (ngModelChange)="filterDrugs()"
         name="search"
         class="form-control"
         placeholder="  search drug name"
         style="max-width: 300px;" />

  <!-- حقل اسم الدواء (Reactive Forms) -->
  <input type="text"
         formControlName="name"
         class="form-control"
         placeholder="  insert drug name"
         style="max-width: 300px;" />

  <button type="submit"
          class="btn btn-sm btn-primary px-3 py-1 "
          [disabled]="drugForm.invalid || loading">
    {{ isEditing ? 'edit' : 'add' }}
  </button>

  <!-- زر الإلغاء في حال التعديل -->
  <button *ngIf="isEditing"
          type="button"
          class="btn btn-sm btn-secondary px-3 py-1"
          (click)="cancelEdit()">
 cancel
  </button>
</form>


<p *ngIf="errorMessage" class="text-danger text-center">{{ errorMessage }}</p>

<div class="container p-4 rounded bg-white">
  <!-- قائمة الأدوية -->
  <ul class="list-group">
    <li *ngFor="let drug of paginatedDrugs" class="list-group-item d-flex justify-content-between align-items-center">
      <!-- الاسم أو خانة التعديل -->
      <div class="flex-grow-1 me-3">
        <div *ngIf="editDrugId !== drug.id" class="fw-semibold">
          {{ drug.name }}
        </div>
        <div *ngIf="editDrugId === drug.id">
          <input [(ngModel)]="drugForm.controls['name'].value" class="form-control" />
        </div>
      </div>

      <!-- أزرار العمليات -->
      <div class="btn-group btn-group-sm">
        <button *ngIf="editDrugId !== drug.id"
                class="btn btn-outline-success"
                (click)="editDrug(drug)">edit</button>

        <button *ngIf="editDrugId === drug.id"
                class="btn btn-outline-success"
                (click)="onSubmit()">save</button>

        <button *ngIf="editDrugId === drug.id"
                class="btn btn-outline-secondary"
                (click)="cancelEdit()">cancel</button>

        <button class="btn btn-outline-danger"
                (click)="deleteDrug(drug.id)">delete</button>
      </div>
    </li>
  </ul>


  <!-- 📄 التصفح -->
  <nav *ngIf="totalPages > 1" class="mt-4">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="changePage(currentPage - 1)">previous</button>
      </li>
      <li class="page-item"
          *ngFor="let page of [].constructor(totalPages); let i = index"
          [class.active]="currentPage === i + 1">
        <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button class="page-link" (click)="changePage(currentPage + 1)">next</button>
      </li>
    </ul>
  </nav>
